{"paragraphs":[{"text":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\n\nimport com.google.cloud.hadoop.io.bigquery.BigQueryConfiguration\nimport com.google.cloud.hadoop.io.bigquery.BigQueryFileFormat\nimport com.google.cloud.hadoop.io.bigquery.GsonBigQueryInputFormat\nimport com.google.cloud.hadoop.io.bigquery.output.BigQueryOutputConfiguration\nimport com.google.cloud.hadoop.io.bigquery.output.IndirectBigQueryOutputFormat\nimport com.google.gson.JsonObject\nimport org.apache.hadoop.io.LongWritable\nimport org.apache.hadoop.mapreduce.lib.output.TextOutputFormat\n","user":"anonymous","dateUpdated":"2017-10-05T18:36:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.commons.io.IOUtils\n\nimport java.net.URL\n\nimport java.nio.charset.Charset\n\nimport com.google.cloud.hadoop.io.bigquery.BigQueryConfiguration\n\nimport com.google.cloud.hadoop.io.bigquery.BigQueryFileFormat\n\nimport com.google.cloud.hadoop.io.bigquery.GsonBigQueryInputFormat\n\nimport com.google.cloud.hadoop.io.bigquery.output.BigQueryOutputConfiguration\n\nimport com.google.cloud.hadoop.io.bigquery.output.IndirectBigQueryOutputFormat\n\nimport com.google.gson.JsonObject\n\nimport org.apache.hadoop.io.LongWritable\n\nimport org.apache.hadoop.mapreduce.lib.output.TextOutputFormat\n"}]},"apps":[],"jobName":"paragraph_1507228588109_937317903","id":"20170927-202627_970177482","dateCreated":"2017-10-05T18:36:28+0000","dateStarted":"2017-10-05T18:36:54+0000","dateFinished":"2017-10-05T18:37:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1181"},{"text":"val conf = sc.hadoopConfiguration\r\n\r\n// Input parameters.\r\nval fullyQualifiedInputTableId = \"mortgage-data-warehouse:FHLMC.FHLMC_all_46m\"\r\nval projectId = conf.get(\"fs.gs.project.id\")\r\nval bucket = conf.get(\"fs.gs.system.bucket\")\r\n\r\n// Input configuration.\r\nconf.set(BigQueryConfiguration.PROJECT_ID_KEY, projectId)\r\nconf.set(BigQueryConfiguration.GCS_BUCKET_KEY, bucket)\r\nBigQueryConfiguration.configureBigQueryInput(conf, fullyQualifiedInputTableId)\r\n\r\n// Load data from BigQuery.\r\nval tableData = sc.newAPIHadoopRDD(\r\n    conf,\r\n    classOf[GsonBigQueryInputFormat],\r\n    classOf[LongWritable],\r\n    classOf[JsonObject]).cache\r\n\r\n// Helper to convert JsonObjects to (word, count) tuples.\r\n/*def convertToTuple(record: JsonObject) : (String, Long) = {\r\n  val word = record.get(\"Loan\").getAsString.toLowerCase\r\n  val count = record.get(\"Num_of_Loas\").getAsLong\r\n  return (word, count)\r\n}\r\n*/","user":"anonymous","dateUpdated":"2017-10-05T18:37:27+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nconf: org.apache.hadoop.conf.Configuration = Configuration: core-default.xml, core-site.xml, mapred-default.xml, mapred-site.xml, yarn-default.xml, yarn-site.xml, hdfs-default.xml, hdfs-site.xml, file:/etc/hive/conf.dist/hive-site.xml\n\nfullyQualifiedInputTableId: String = mortgage-data-warehouse:FHLMC.FHLMC_all_46m\n\nprojectId: String = mortgage-data-warehouse\n\nbucket: String = dataproc-8adad88a-330a-4cbd-9a69-57e1d2afdebd-us\n\ntableData: org.apache.spark.rdd.RDD[(org.apache.hadoop.io.LongWritable, com.google.gson.JsonObject)] = NewHadoopRDD[0] at newAPIHadoopRDD at <console>:40\n"}]},"apps":[],"jobName":"paragraph_1507228588113_948090873","id":"20170927-202629_634302269","dateCreated":"2017-10-05T18:36:28+0000","dateStarted":"2017-10-05T18:37:27+0000","dateFinished":"2017-10-05T18:37:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1182"},{"text":"//tableData.take(10).foreach(entry => print(entry.getClass))\nprint(tableData.getClass)\n\nval test0 = tableData\n//    .map(entry => convertToTuple(entry._2))\n      .map(entry => entry._2.toString()).cache\n\nval test = spark.read.json(test0).cache\n\ntest.printSchema\n\n","user":"anonymous","dateUpdated":"2017-10-05T18:37:42+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"class org.apache.spark.rdd.NewHadoopRDD\ntest0: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at map at <console>:44\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\ntest: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [Age_Q: string, Amort_Type_Q: string ... 46 more fields]\nroot\n |-- Age_Q: string (nullable = true)\n |-- Amort_Type_Q: string (nullable = true)\n |-- As_Of_Dt_Q: string (nullable = true)\n |-- Channel_Q: string (nullable = true)\n |-- Conforming_Flag_Q: string (nullable = true)\n |-- Cost_Legal_Q: long (nullable = true)\n |-- Cost_Maint_Preserv_Q: long (nullable = true)\n |-- Cost_Misc_Q: long (nullable = true)\n |-- Cost_TI_Q: long (nullable = true)\n |-- Cost_Total_Q: long (nullable = true)\n |-- DTI_Orig_Q: long (nullable = true)\n |-- Delinquency_Info_Status_Q: string (nullable = true)\n |-- Exit_Event_Q: string (nullable = true)\n |-- FICO_Orig_Q: string (nullable = true)\n |-- First_Pmt_Dt_Q: string (nullable = true)\n |-- First_Time_Buyer_Q: string (nullable = true)\n |-- Int_Paid_To_Dt_Q: string (nullable = true)\n |-- LTV_Combined_Orig_Q: long (nullable = true)\n |-- LTV_Orig_Q: long (nullable = true)\n |-- Loan_Num_Q: string (nullable = true)\n |-- Loan_Purpose_Q: string (nullable = true)\n |-- Loss_Amt_Q: long (nullable = true)\n |-- MI_Percentage_Q: long (nullable = true)\n |-- MSA_Q: string (nullable = true)\n |-- Maturity_Dt_Q: string (nullable = true)\n |-- Mod_Cost_Q: double (nullable = true)\n |-- Mod_Flag_Q: string (nullable = true)\n |-- Net_Liquidation_Proceeds_Text_Q: string (nullable = true)\n |-- Note_Rate_Q: double (nullable = true)\n |-- Num_Units_Q: string (nullable = true)\n |-- Num_of_Borrowers_Q: string (nullable = true)\n |-- Orig_Bal_Q: long (nullable = true)\n |-- Orig_Rate_Q: double (nullable = true)\n |-- Orig_Term_Q: string (nullable = true)\n |-- Owner_Occup_Q: string (nullable = true)\n |-- PrePay_Penalty_Flag_Q: string (nullable = true)\n |-- Prop_Type_Q: string (nullable = true)\n |-- Recoveries_MI_Q: long (nullable = true)\n |-- Recoveries_Non_MI_Q: long (nullable = true)\n |-- Rem_Term_Q: string (nullable = true)\n |-- Repurchase_Flag_Q: string (nullable = true)\n |-- Seller_Name_Q: string (nullable = true)\n |-- Servicer_Q: string (nullable = true)\n |-- State_Q: string (nullable = true)\n |-- UPB_Deferred_Q: double (nullable = true)\n |-- UPB_Q: double (nullable = true)\n |-- Zero_Bal_Dt_Q: string (nullable = true)\n |-- Zip_Code_Q: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1507228588114_949245119","id":"20170927-203538_9528790","dateCreated":"2017-10-05T18:36:28+0000","dateStarted":"2017-10-05T18:37:42+0000","dateFinished":"2017-10-05T18:50:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1183"},{"text":"//test.toDF().select(\"Age_Q\").show()\n//.select(\"Age_Q\").take(10).foreach(l => println(l))\nval fhlmc = test.toDF().registerTempTable(\"fhlmc\")\n\nval outputGcsPath = (\"gs://\" + projectId + \"/FHLMC/tmp/dataproc\")\n\n//val test_save = test.toDF().coalesce(1)\n//import org.apache.spark.sql.{SaveMode, SparkSession}\n//test_save.write.mode(SaveMode.Overwrite).csv(outputGcsPath + \"/hdfs/test_save.csv\")\n\n\ntest.select(\"Loan_num_q\").write.csv(\"gs://\" + projectId + \"/FHLMC/tmp/dataproc/test_ds_save.csv\")\n//test.saveAsTextFile(\"gs://\" + projectId + \"/FHLMC/tmp/dataproc\")\n\n\n","user":"anonymous","dateUpdated":"2017-10-05T21:16:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nfhlmc: Unit = ()\n\noutputGcsPath: String = gs://mortgage-data-warehouse/FHLMC/tmp/dataproc\n"}]},"apps":[],"jobName":"paragraph_1507228588115_948860370","id":"20170929-152315_65608423","dateCreated":"2017-10-05T18:36:28+0000","dateStarted":"2017-10-05T21:16:57+0000","dateFinished":"2017-10-05T21:17:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1184"},{"text":"%sql \nselect age_q, count(1) value\nfrom fhlmc \ngroup by age_q","user":"anonymous","dateUpdated":"2017-10-05T18:50:22+0000","config":{"colWidth":6,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"age_q","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"value","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"age_q\tvalue\n125\t45941\n7\t924598\n51\t330140\n124\t47168\n169\t4823\n205\t773\n15\t800274\n54\t306665\n155\t14977\n132\t36508\n154\t15778\n200\t1007\n11\t868124\n101\t90896\n138\t28299\n29\t578686\n69\t219851\n112\t67070\n42\t429854\n87\t134023\n73\t196709\n64\t245082\n3\t955198\n30\t566638\n113\t65063\n34\t522031\n133\t34859\n59\t273093\n162\t8082\n146\t21663\n139\t27203\n8\t911933\n160\t9355\n22\t678402\n184\t1876\n28\t591091\n203\t853\n199\t1032\n85\t144165\n35\t511545\n16\t781986\n52\t322087\n171\t4329\n183\t2008\n0\t852846\n187\t1522\n71\t207771\n98\t98388\n188\t1462\n47\t369951\n99\t95970\n195\t1163\n110\t71260\n107\t77248\nnull\t468\n179\t2587\n96\t103057\n202\t904\n43\t417459\n5\t948034\n31\t555392\n163\t7586\n100\t93531\n18\t744319\n70\t213776\n174\t3714\n206\t713\n168\t5198\n27\t604102\n61\t260877\n75\t187215\n166\t6088\n17\t763348\n140\t26247\n131\t38009\n126\t44606\n26\t618194\n120\t52854\n46\t381539\n130\t39570\n147\t21005\n164\t7087\n207\t630\n78\t173777\n208\t525\n89\t124560\n77\t178188\n136\t30703\n198\t1055\n6\t936168\n118\t56092\n185\t1740\n201\t959\n177\t3081\n104\t83711\n90\t120411\n60\t266633\n68\t225921\n194\t1205\n19\t726522\n23\t663234\n41\t441899\n128\t42182\n102\t88461\n55\t299654\n111\t69210\n197\t1081\n167\t5580\n93\t110448\n95\t105564\n40\t453740\n38\t479166\n103\t85927\n25\t632894\n189\t1417\n44\t405062\n156\t14178\n190\t1371\n135\t31853\n144\t22970\n176\t3346\n115\t61317\n82\t156700\n193\t1249\n53\t314314\n92\t113166\n122\t49915\n108\t75239\n117\t57754\n86\t139356\n58\t279619\n204\t817\n81\t160926\n33\t533147\n114\t63034\n150\t18261\n170\t4545\n178\t2804\n48\t358664\n153\t16388\n141\t25369\n180\t2446\n148\t20256\n173\t3928\n97\t100765\n159\t10138\n209\t412\n67\t231073\n106\t79387\n158\t11382\n84\t148260\n143\t23726\n79\t169679\n24\t648088\n9\t897512\n32\t544519\n116\t59549\n152\t17021\n186\t1610\n134\t33326\n88\t129073\n1\t934708\n149\t19243\n105\t81512\n20\t710085\n142\t24521\n56\t293061\n127\t43329\n36\t501157\n211\t122\n10\t883202\n37\t490535\n165\t6597\n49\t347966\n172\t4121\n63\t249943\n181\t2314\n65\t240376\n4\t953017\n121\t51285\n39\t467031\n210\t271\n62\t255288\n12\t852249\n83\t152373\n109\t73171\n123\t48553\n13\t835703\n157\t13036\n191\t1331\n14\t818207\n21\t693797\n182\t2162\n66\t235668\n94\t108071\n91\t116555\n175\t3525\n72\t201982\n74\t191938\n137\t29554\n161\t8651\n151\t17620\n129\t40910\n76\t182633\n2\t952202\n196\t1116\n192\t1284\n80\t165480\n50\t338667\n145\t22264\n45\t393060\n57\t286209\n119\t54450\n"}]},"apps":[],"jobName":"paragraph_1507228588116_946936626","id":"20170927-202907_282031011","dateCreated":"2017-10-05T18:36:28+0000","dateStarted":"2017-10-05T18:50:22+0000","dateFinished":"2017-10-05T19:01:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1185"},{"dateUpdated":"2017-10-05T19:05:14+0000","config":{"colWidth":6,"editorMode":"ace/mode/sql","results":{},"enabled":true,"editorSetting":{"language":"sql","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507228588117_946551877","id":"20171005-143255_307464260","dateCreated":"2017-10-05T18:36:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1186","text":"%bigquery.sql\r\n#standardSQL\r\nSELECT distinct state_q FROM `mortgage-data-warehouse.FHLMC.FHLMC_orig` order by State_Q\r\n--limit 10","user":"anonymous","dateFinished":"2017-10-05T19:05:26+0000","dateStarted":"2017-10-05T19:05:14+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"state_q\t\nAK\t\nAL\t\nAR\t\nAZ\t\nCA\t\nCO\t\nCT\t\nDC\t\nDE\t\nFL\t\nGA\t\nGU\t\nHI\t\nIA\t\nID\t\nIL\t\nIN\t\nKS\t\nKY\t\nLA\t\nMA\t\nMD\t\nME\t\nMI\t\nMN\t\nMO\t\nMS\t\nMT\t\nNC\t\nND\t\nNE\t\nNH\t\nNJ\t\nNM\t\nNV\t\nNY\t\nOH\t\nOK\t\nOR\t\nPA\t\nPR\t\nRI\t\nSC\t\nSD\t\nTN\t\nTX\t\nUT\t\nVA\t\nVI\t\nVT\t\nWA\t\nWI\t\nWV\t\nWY\t\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507229443616_1672953391","id":"20171005-185043_1320998294","dateCreated":"2017-10-05T18:50:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1187","text":"// Output parameters.\r\nval outputTableId = projectId + \":FHLMC.test_output\"\r\n// Temp output bucket that is deleted upon completion of job.\r\nval outputGcsPath = (\"gs://\" + bucket + \"/hadoop/tmp/bigquery/testoutput\")\r\n\r\n// Output configuration.\r\n// Let BigQueery auto-detect output schema (set to null below).\r\nBigQueryOutputConfiguration.configure(conf,\r\n                                      outputTableId,\r\n                                      null,\r\n                                      outputGcsPath,\r\n                                      BigQueryFileFormat.NEWLINE_DELIMITED_JSON,\r\n                                      classOf[TextOutputFormat[_,_]])\r\n\r\nconf.set(\"mapreduce.job.outputformat.class\",\r\n         classOf[IndirectBigQueryOutputFormat[_,_]].getName)\r\n\r\n// Truncate the table before writing output to allow multiple runs.\r\nconf.set(BigQueryConfiguration.OUTPUT_TABLE_WRITE_DISPOSITION_KEY,\r\n         \"WRITE_TRUNCATE\")\r\n\r\n// Helper to convert JsonObjects to (word, count) tuples.\r\ndef convertToTuple(record: JsonObject) : (String, Long) = {\r\n  val word = record.get(\"word\").getAsString.toLowerCase\r\n  val count = record.get(\"word_count\").getAsLong\r\n  return (word, count)\r\n}\r\n\r\n// Helper to convert (word, count) tuples to JsonObjects.\r\ndef convertToJson(pair: (String, Long)) : JsonObject = {\r\n  val word = pair._1\r\n  val count = pair._2\r\n  val jsonObject = new JsonObject()\r\n  jsonObject.addProperty(\"word\", word)\r\n  jsonObject.addProperty(\"word_count\", count)\r\n  return jsonObject\r\n}\r\n\r\n// Write data back into a new BigQuery table.\r\n// IndirectBigQueryOutputFormat discards keys, so set key to null.\r\n(wordCounts\r\n    .map(pair => (null, convertToJson(pair)))\r\n    .saveAsNewAPIHadoopDataset(conf))","dateUpdated":"2017-10-05T19:07:52+0000","dateFinished":"2017-10-05T19:07:52+0000","dateStarted":"2017-10-05T19:07:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nres8: String = dataproc-8adad88a-330a-4cbd-9a69-57e1d2afdebd-us\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507230465237_956624270","id":"20171005-190745_2021245556","dateCreated":"2017-10-05T19:07:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1513","text":"projectId","dateUpdated":"2017-10-05T20:10:55+0000","dateFinished":"2017-10-05T20:10:56+0000","dateStarted":"2017-10-05T20:10:55+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nres11: String = mortgage-data-warehouse\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507234247978_-1377591835","id":"20171005-201047_2114993608","dateCreated":"2017-10-05T20:10:47+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1663"}],"name":"FHLMC_spark","id":"2CVQKR871","angularObjects":{"2CU9A77AY:shared_process":[],"2CV1YFQ81:shared_process":[],"2CX19HU8R:shared_process":[],"2CWAXA1S7:shared_process":[],"2CTT5YBFQ:shared_process":[],"2CXNC1E7T:shared_process":[],"2CUZBPN5T:shared_process":[],"2CXHGYWRU:shared_process":[],"2CWNRG85H:shared_process":[],"2CUH7SXB1:shared_process":[],"2CV1TPGB6:shared_process":[],"2CX67WX1R:shared_process":[],"2CUS5TH9U:shared_process":[],"2CU1DMXDA:shared_process":[],"2CWBTFK4M:shared_process":[],"2CUKNPFPE:shared_process":[],"2CWPU5DTN:shared_process":[],"2CUSRSHXY:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}